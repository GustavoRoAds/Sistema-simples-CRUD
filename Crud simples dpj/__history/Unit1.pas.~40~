unit Unit1;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf,
  FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys,
  FireDAC.VCLUI.Wait, FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf,
  FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client, Vcl.StdCtrls,
  Vcl.ExtCtrls, Vcl.Grids, Vcl.DBGrids, FireDAC.Phys.SQLite,
  FireDAC.Phys.SQLiteDef, FireDAC.Stan.ExprFuncs,
  FireDAC.Phys.SQLiteWrapper.Stat;

type
  TForm1 = class(TForm)
    DBGrid1: TDBGrid;
    Panel1: TPanel;
    Pesquisa: TLabel;
    edtPesquisa: TEdit;
    btnListar: TButton;
    oQry: TFDQuery;
    btnNovo: TButton;
    btnEdit: TButton;
    btnDeletar: TButton;
    DataSource1: TDataSource;
    oCon: TFDConnection;
    procedure FormCreate(Sender: TObject);
    procedure btnNovoClick(Sender: TObject);
    procedure btnListarClick(Sender: TObject);
    procedure btnEditClick(Sender: TObject);
    procedure btnDeletarClick(Sender: TObject);
  private
    procedure estruturabd;
    procedure pegadados;
    function validaCampo: boolean;
    { Private declarations }
  public
    { Public declarations }
    idSelecionado: integer;
  end;


var
  Form1: TForm1;

implementation

{$R *.dfm}

uses Unit2, Unit3;

procedure TForm1.btnListarClick(Sender: TObject);
begin
  pegadados;
end;

procedure TForm1.pegadados;
begin
  oQry.Close;
  oQry.SQL.Clear;

  if edtPesquisa.Text <> '' then
  begin
    oQry.SQL.Add(' SELECT * from clientes where nome LIKE :nome');
    oQry.ParamByName('nome').AsString := '%'+edtPesquisa.Text+'%';
  end
  else
  begin
    oQry.SQL.Add(' SELECT * from clientes');
  end;

  oQry.Open();
end;

procedure TForm1.btnNovoClick(Sender: TObject);
begin
  fNovo.ShowModal;
  pegadados;
end;

procedure TForm1.btnDeletarClick(Sender: TObject);
begin

  if validaCampo=false then
  begin
    ShowMessage('Nenhum cliente Selecionado!');
    exit;
  end;

  if MessageDlg('Deseja realmente Excluir este cliente?', mtConfirmation, [mbYes, mbNo],0) = mrYes  then
  begin
    idSelecionado := oQry.FieldByName('id').AsInteger;

    oQry.Close;
    oQry.SQL.Clear;

    oQry.SQL.Add(' delete from clientes where id = :idSelecionado');
    oQry.ParamByName('idSelecionado').AsInteger := idSelecionado;
    oQry.ExecSQL;
    pegadados;
  end
  else
    exit;
end;

function TForm1.validaCampo:boolean;
begin
  Result := false;

  if oQry.FieldByName('id').AsInteger > 1 then
    Result := true
  else
    Result := false;

  if oQry.RecordCount < 0 then
    ShowMessage('Nehum selecionado e nenhum registro')
end;

procedure TForm1.btnEditClick(Sender: TObject);
begin
  if validaCampo=false then
  begin
    ShowMessage('Nenhum cliente Selecionado!');
    exit;
  end;

  fEditar.idSelecionado := oQry.FieldByName('id').AsInteger;
  fEditar.ShowModal;
  pegadados;
end;

procedure TForm1.estruturabd;
begin
  oCon.Connected := true;

  oQry.Close;
  oQry.SQL.Clear;
  oQry.SQL.Add(' CREATE TABLE IF NOT EXISTS clientes (');
  oQry.SQL.Add('id INTEGER PRIMARY KEY AUTOINCREMENT,');
  oQry.SQL.Add('nome VARCHAR(100),');
  oQry.SQL.Add('idade INTEGER,');
  oQry.SQL.Add('email VARCHAR(100))');
  oQry.ExecSQL;
end;

procedure TForm1.FormCreate(Sender: TObject);
begin
  oCon.Connected := true;
  estruturabd;
end;

end.
